'use client';

import { useRouter } from 'next/navigation';
import { useEffect, useState } from 'react';
import { jwtDecode } from 'jwt-decode';

export default function Navbar() {
  const router = useRouter();
  const [tokenInfo, setTokenInfo] = useState(null);

  useEffect(() => {
    const token = localStorage.getItem('token');
    if (token) {
      try {
        const decoded = jwtDecode(token);
        setTokenInfo(decoded); // { id, email, role, first_name, last_name }
      } catch (err) {
        localStorage.removeItem('token');
        setTokenInfo(null);
      }
    }
  }, []);

  const handleLogout = () => {
    localStorage.removeItem('token');
    setTokenInfo(null);
    router.push('/login');
  };

  const handleLogin = () => {
    router.push('/login');
  };

  return (
    <nav style={{
      display: 'flex',
      justifyContent: 'space-between',
      alignItems: 'center',
      background: '#eee',
      padding: '1rem'
    }}>
      <div><a href="/">üè† ÊïôËÇ≤AI„Ç∑„Çπ„ÉÜ„É†</a></div>

      {tokenInfo ? (
        <div style={{ display: 'flex', alignItems: 'center', gap: '1rem' }}>
          <span>
            üë§ {tokenInfo.last_name} {tokenInfo.first_name} „Åï„ÇìÔºà{tokenInfo.role}Ôºâ
          </span>

          {tokenInfo.role === 'parent' && (
            <>
              <a href="/users">„É¶„Éº„Ç∂„Éº</a>
              <a href="/children">Â≠ê„Å©„ÇÇ</a>
            </>
          )}

          {tokenInfo.role === 'admin' && (
            <>
              <a href="/admin/users">ÂÖ®„É¶„Éº„Ç∂„Éº</a>
            </>
          )}

          <button onClick={handleLogout}>„É≠„Ç∞„Ç¢„Ç¶„Éà</button>
        </div>
      ) : (
        <button onClick={handleLogin}>„É≠„Ç∞„Ç§„É≥</button>
      )}
    </nav>
  );
}
